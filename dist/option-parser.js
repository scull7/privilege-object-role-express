// Generated by CoffeeScript 1.10.0
(function() {
  var _maybeWithDefault, _validate, defaults, fromJson, parser, validate;

  fromJson = require('privilege-object-role').fromJson;

  validate = require('./option-validate');

  defaults = require('./option-default');

  _validate = function(validator, value) {
    var errMsg;
    errMsg = validator(value);
    if (errMsg) {
      throw new TypeError(errMsg);
    }
    return value;
  };

  _maybeWithDefault = function(_default, value) {
    if (value) {
      return value;
    } else {
      return _default;
    }
  };

  parser = function(options) {
    var addRoles, getContext, map;
    map = options.map, getContext = options.getContext, addRoles = options.addRoles;
    if (!map) {
      throw new TypeError('map_required');
    }
    return {
      map: map,
      getContext: _validate(validate.getContext, _maybeWithDefault(defaults.getContext, getContext)),
      addRoles: _validate(validate.addRoles, _maybeWithDefault(defaults.addRoles, addRoles))
    };
  };

  module.exports = parser;

}).call(this);
